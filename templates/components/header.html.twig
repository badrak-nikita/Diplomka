{% block body %}
    <link href="/assets/css/header.css" rel="stylesheet">
    <link href="/assets/css/authorization.css" rel="stylesheet">
    <header id="header" class="header d-flex align-items-center fixed-top">
        <div class="header-container container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

            <a href="{{ path('app_home') }}" class="logo d-flex align-items-center me-auto me-xl-0">
                <img src="/assets/img/icon.png" alt="logo" style="width: 40px; height: 50px;">
                <h1 class="sitename">Дипломка</h1>
            </a>

            <nav id="navmenu" class="navmenu">
                <ul>
                    <li>
                        <a href="{{ path('app_home') }}" class="{{ app.request.attributes.get('_route') == 'app_home' ? 'active' : '' }}">
                            Головна
                        </a>
                    </li>
                    <li>
                        <a href="{{ path('app_prices') }}" class="{{ app.request.attributes.get('_route') == 'app_prices' ? 'active' : '' }}">
                            Цiни
                        </a>
                    </li>
                    <li>
                        <a href="{{ path('app_reviews') }}" class="{{ app.request.attributes.get('_route') == 'app_reviews' ? 'active' : '' }}">
                            Вiдгуки
                        </a>
                    </li>
                    <li>
                        <a href="{{ path('app_contacts') }}" class="{{ app.request.attributes.get('_route') == 'app_contacts' ? 'active' : '' }}">
                            Контакти
                        </a>
                    </li>
                    <li>
                        <a href="{{ path('app_order') }}" class="{{ app.request.attributes.get('_route') == 'app_order' ? 'active' : '' }}">
                            Замовити роботу
                        </a>
                    </li>
                    <li>
                        {% if is_granted('ROLE_ADMIN') %}
                            <a href="{{ path('admin_home') }}" class="{{ app.request.attributes.get('_route') == 'admin_home' ? 'active' : '' }}">
                                Панель керування
                            </a>
                        {% endif %}
                    </li>
                </ul>
                <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
            </nav>

            {% if app.user %}
                <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-decoration-none text-dark dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="{{ app.user.profileImage ? asset(app.user.profileImage) : asset('assets/img/user.png') }}" alt="Avatar" class="rounded-circle" width="40" height="40">
                        <span class="ms-2 d-none d-md-inline">{{ app.user.username ?: app.user.email }}</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li><a class="dropdown-item" href="{{ path('app_profile') }}">Профіль</a></li>
                        <li><a class="dropdown-item" href="{{ path('app_logout') }}">Вийти</a></li>
                    </ul>
                </div>
            {% else %}
                <a class="btn-getstarted" href="#" data-bs-toggle="modal" data-bs-target="#authModal">Вхід</a>
            {% endif %}

        </div>
    </header>

    <div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
            <div class="modal-content p-4">

                <form id="loginForm" class="material-form" method="POST" action="{{ path('app_login') }}" style="display: block;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                        <h2 style="margin: 0;">Авторизація</h2>
                        <img src="/assets/img/icon.png" alt="logo" style="width: 50px; height: 50px;">
                    </div>

                    <div class="input-field">
                        <input type="email" id="loginEmail" name="email" required value="{{ last_username|default('') }}" autocomplete="email" placeholder=" ">
                        <label for="loginEmail">Email</label>
                        <span class="bar"></span>
                    </div>

                    <div class="input-field">
                        <input type="password" id="loginPassword" name="password" required autocomplete="current-password" placeholder=" ">
                        <label for="loginPassword">Пароль</label>
                        <span class="bar"></span>
                    </div>

                    {% if error is defined and error %}
                        <div class="error-text mb-3">{{ error }}</div>
                    {% endif %}

                    <button type="submit">Увійти</button>

                    <a id="showRegisterBtn">Перейти до реєстрації</a>
                </form>

                <form id="registerForm" class="circle-form" method="POST" action="{{ path('app_register') }}" style="display: none;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                        <h2 style="margin: 0;">Реєстрація</h2>
                        <img src="/assets/img/icon.png" alt="logo" style="width: 50px; height: 50px;">
                    </div>

                    <input type="text" id="registerName" name="name" required autocomplete="name" placeholder="Iм'я">
                    <span class="bar"></span>

                    <input type="email" id="registerEmail" name="email" required autocomplete="email" placeholder="Email">
                    <span class="bar"></span>

                    <input type="password" id="registerPassword" name="password" required placeholder="Пароль">
                    <span class="bar"></span>

                    <input type="password" id="registerConfirmPassword" name="confirm_password" required placeholder="Підтвердження пароля">
                    <span class="bar"></span>

                    <div id="passwordError" class="error-text" style="display:none; margin-bottom: 10px;"></div>

                    {% if error is defined and error %}
                        <div class="error-text">{{ error }}</div>
                    {% endif %}

                    <button type="submit">Зареєструватись</button>

                    <a id="showLoginBtn">Перейти до входу</a>
                </form>

            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const showRegisterBtn = document.getElementById("showRegisterBtn");
            const showLoginBtn = document.getElementById("showLoginBtn");
            const loginForm = document.getElementById("loginForm");
            const registerForm = document.getElementById("registerForm");

            showRegisterBtn.addEventListener("click", function() {
                loginForm.style.display = "none";
                registerForm.style.display = "block";
            });

            showLoginBtn.addEventListener("click", function() {
                registerForm.style.display = "none";
                loginForm.style.display = "block";
            });

            const passwordInput = document.getElementById("registerPassword");
            const confirmPasswordInput = document.getElementById("registerConfirmPassword");
            const passwordError = document.getElementById("passwordError");

            registerForm.addEventListener("submit", function(event) {
                if (passwordInput.value !== confirmPasswordInput.value) {
                    event.preventDefault();
                    passwordError.style.display = "block";
                    passwordError.textContent = "Паролi неiдентичнi";
                } else {
                    passwordError.style.display = "none";
                }
            });

            {% if error is defined and error %}
                var authModal = new bootstrap.Modal(document.getElementById('authModal'));
                authModal.show();
            {% endif %}
        });
    </script>
{% endblock %}
